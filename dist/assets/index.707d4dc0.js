var Je=Object.defineProperty;var Ye=(r,t,e)=>t in r?Je(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var y=(r,t,e)=>(Ye(r,typeof t!="symbol"?t+"":t,e),e),he=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var m=(r,t,e)=>(he(r,t,"read from private field"),e?e.call(r):t.get(r)),a=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},g=(r,t,e,s)=>(he(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);var h=(r,t,e)=>(he(r,t,"access private method"),e);const Xe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}};Xe();var H,Fe;class Qe{constructor({height:t=window.innerHeight,width:e=window.innerWidth,id:s}){a(this,H);this.canvas=document.getElementById(s),this.ctx=this.canvas.getContext("2d"),h(this,H,Fe).call(this,t,e)}getCtx(){return this.ctx}getMidPoint(){return{x:this.canvas.width/2,y:this.canvas.height/2}}getDimensions(){return{width:this.canvas.width,height:this.canvas.height}}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}H=new WeakSet,Fe=function(t,e){this.canvas.height=t,this.canvas.width=e};var I,ye;class Ze{constructor({dimensions:t,gridLines:e,spacing:s,coordToPosition:i}){a(this,I);this.dimensions=t,this.gridLines=e,this.spacing=s,this.coordToPosition=i}drawLines(t){h(this,I,ye).call(this,t)}getSpacing(){return this.spacing}}I=new WeakSet,ye=function(t){t.strokeStyle="gray",this.gridLines.forEach(e=>{t.beginPath(),t.moveTo(e.start.x,e.start.y),t.lineTo(e.end.x,e.end.y),t.stroke()})};class ge{constructor({start:t,end:e}){this.start=t,this.end=e}get(){return{start:this.start,end:this.end}}}var W,we,q,Ce,V,pe,j,De,N,Be,G,Me,U,Ee;class x{static create({dimensions:t,canvasSize:e,midPoint:s}){return h(this,W,we).call(this,t,e,s)}static coordToPosition(t,e){const s=t/2;return i=>({x:e.x+s+t*(i.x-1),y:e.y+s+t*(i.y-1)})}}W=new WeakSet,we=function(t,e,s){t=h(this,q,Ce).call(this,t);const i=h(this,V,pe).call(this,t,e),n=h(this,j,De).call(this,t,i,s),o=h(this,N,Be).call(this,t,i,n),l=this.coordToPosition(i,n);return new Ze({dimensions:t,gridLines:o,spacing:i,coordToPosition:l})},q=new WeakSet,Ce=function(t){return{x:Math.min(t.x,200),y:Math.min(t.y,200)}},V=new WeakSet,pe=function(t,e){const s=Math.floor(e.width*1),i=Math.floor(e.height*1),n=Math.floor((s-t.x)/t.x),o=Math.floor((i-t.y)/t.y);return Math.min(n,o)},j=new WeakSet,De=function(t,e,s){const i=Math.round(s.x-t.x*e/2),n=Math.round(s.y-t.y*e/2);return{x:i,y:n}},N=new WeakSet,Be=function(t,e,s){const i=[],n=h(this,G,Me).call(this,t,e),o=h(this,U,Ee).call(this,t,e);for(let l=0;l<=t.x;l++)i.push(new ge({start:{x:s.x+l*e,y:s.y},end:{x:s.x+l*e,y:s.y+n}}));for(let l=0;l<=t.y;l++)i.push(new ge({start:{x:s.x,y:s.y+l*e},end:{x:s.x+o,y:s.y+l*e}}));return i},G=new WeakSet,Me=function(t,e){return t.y*e},U=new WeakSet,Ee=function(t,e){return t.x*e},a(x,W),a(x,q),a(x,V),a(x,j),a(x,N),a(x,G),a(x,U);class d{constructor({x:t,y:e}){this.x=t,this.y=e}add({x:t,y:e}){this.x+=t,this.y+=e}static sumCoords(t,e){return new d({x:t.x+e.x,y:t.y+e.y})}}var p,M,E;class ve{constructor({coordinates:t,radius:e,colour:s}){a(this,p,void 0);a(this,M,void 0);a(this,E,void 0);g(this,p,new d(t)),g(this,M,e),g(this,E,s)}getCoordinates(){return m(this,p)}setCoordinates(t){g(this,p,t)}getRadius(){return m(this,M)}getColour(){return m(this,E)}}p=new WeakMap,M=new WeakMap,E=new WeakMap;var v,oe;const ue=class{constructor(){a(this,v);this.lifeSense=[0,0,0,0,0,0,0,0],this.foodSense=[0,0,0,0,0,0,0,0],this.wallSense=[0,0,0,0,0,0,0,0]}sense(t,e,s){this.lifeSense=[0,0,0,0,0,0,0,0],this.foodSense=[0,0,0,0,0,0,0,0],this.wallSense=[0,0,0,0,0,0,0,0],ue.offsets.forEach((i,n)=>{const o=h(this,v,oe).call(this,i,t,e,s);switch(o.type){case"Life":this.lifeSense[n]=o.value;break;case"Food":this.foodSense[n]=o.value;break;case"Wall":this.wallSense[n]=o.value;break}})}};let D=ue;v=new WeakSet,oe=function(t,e,s,i,n=i){if(i==0)return 0;const o=e.x+t.x*(1+n-i),l=e.y+t.y*(1+n-i),u=s.getObjectAt(o,l);return u?{value:i,type:u.getType()}:u===void 0?{value:i,type:"Wall"}:h(this,v,oe).call(this,t,e,s,i-1,n)},y(D,"offsets",[new d({x:0,y:-1}),new d({x:1,y:-1}),new d({x:1,y:0}),new d({x:1,y:1}),new d({x:0,y:1}),new d({x:-1,y:1}),new d({x:-1,y:0}),new d({x:-1,y:-1})]);class f{}y(f,"up",new d({x:0,y:-1})),y(f,"right",new d({x:1,y:0})),y(f,"down",new d({x:0,y:1})),y(f,"left",new d({x:-1,y:0}));function xe(r,t,e){return r+(t-r)*e}function L(){return[{hex:"#F0F8FF",name:"AliceBlue"},{hex:"#00FFFF",name:"Aqua"},{hex:"#7FFFD4",name:"Aquamarine"},{hex:"#F0FFFF",name:"Azure"},{hex:"#F5F5DC",name:"Beige"},{hex:"#FFE4C4",name:"Bisque"},{hex:"#000000",name:"Black"},{hex:"#FFEBCD",name:"BlanchedAlmond"},{hex:"#0000FF",name:"Blue"},{hex:"#8A2BE2",name:"BlueViolet"},{hex:"#A52A2A",name:"Brown"},{hex:"#DEB887",name:"BurlyWood"},{hex:"#5F9EA0",name:"CadetBlue"},{hex:"#7FFF00",name:"Chartreuse"},{hex:"#D2691E",name:"Chocolate"},{hex:"#FF7F50",name:"Coral"},{hex:"#6495ED",name:"CornflowerBlue"},{hex:"#FFF8DC",name:"Cornsilk"},{hex:"#DC143C",name:"Crimson"},{hex:"#00FFFF",name:"Cyan"},{hex:"#00008B",name:"DarkBlue"},{hex:"#008B8B",name:"DarkCyan"},{hex:"#B8860B",name:"DarkGoldenRod"},{hex:"#A9A9A9",name:"DarkGray"},{hex:"#BDB76B",name:"DarkKhaki"},{hex:"#8B008B",name:"DarkMagenta"},{hex:"#FF8C00",name:"DarkOrange"},{hex:"#9932CC",name:"DarkOrchid"},{hex:"#8B0000",name:"DarkRed"},{hex:"#E9967A",name:"DarkSalmon"},{hex:"#483D8B",name:"DarkSlateBlue"},{hex:"#2F4F4F",name:"DarkSlateGray"},{hex:"#00CED1",name:"DarkTurquoise"},{hex:"#9400D3",name:"DarkViolet"},{hex:"#FF1493",name:"DeepPink"},{hex:"#00BFFF",name:"DeepSkyBlue"},{hex:"#1E90FF",name:"DodgerBlue"},{hex:"#B22222",name:"FireBrick"},{hex:"#FF00FF",name:"Fuchsia"},{hex:"#DCDCDC",name:"Gainsboro"},{hex:"#FFD700",name:"Gold"},{hex:"#DAA520",name:"GoldenRod"},{hex:"#F0FFF0",name:"HoneyDew"},{hex:"#FF69B4",name:"HotPink"},{hex:"#CD5C5C",name:"IndianRed"},{hex:"#4B0082",name:"Indigo"},{hex:"#FFFFF0",name:"Ivory"},{hex:"#F0E68C",name:"Khaki"},{hex:"#E6E6FA",name:"Lavender"},{hex:"#FFF0F5",name:"LavenderBlush"},{hex:"#FFFACD",name:"LemonChiffon"},{hex:"#00FF00",name:"Lime"},{hex:"#FAF0E6",name:"Linen"},{hex:"#FF00FF",name:"Magenta"},{hex:"#800000",name:"Maroon"},{hex:"#66CDAA",name:"MediumAquaMarine"},{hex:"#0000CD",name:"MediumBlue"},{hex:"#BA55D3",name:"MediumOrchid"},{hex:"#9370DB",name:"MediumPurple"},{hex:"#7B68EE",name:"MediumSlateBlue"},{hex:"#48D1CC",name:"MediumTurquoise"},{hex:"#C71585",name:"MediumVioletRed"},{hex:"#191970",name:"MidnightBlue"},{hex:"#F5FFFA",name:"MintCream"},{hex:"#FFE4E1",name:"MistyRose"},{hex:"#FFE4B5",name:"Moccasin"},{hex:"#000080",name:"Navy"},{hex:"#FDF5E6",name:"OldLace"},{hex:"#808000",name:"Olive"},{hex:"#6B8E23",name:"OliveDrab"},{hex:"#FFA500",name:"Orange"},{hex:"#FF4500",name:"OrangeRed"},{hex:"#DA70D6",name:"Orchid"},{hex:"#EEE8AA",name:"PaleGoldenRod"},{hex:"#AFEEEE",name:"PaleTurquoise"},{hex:"#DB7093",name:"PaleVioletRed"},{hex:"#FFEFD5",name:"PapayaWhip"},{hex:"#FFDAB9",name:"PeachPuff"},{hex:"#CD853F",name:"Peru"},{hex:"#FFC0CB",name:"Pink"},{hex:"#DDA0DD",name:"Plum"},{hex:"#B0E0E6",name:"PowderBlue"},{hex:"#800080",name:"Purple"},{hex:"#663399",name:"RebeccaPurple"},{hex:"#FF0000",name:"Red"},{hex:"#BC8F8F",name:"RosyBrown"},{hex:"#4169E1",name:"RoyalBlue"},{hex:"#8B4513",name:"SaddleBrown"},{hex:"#FA8072",name:"Salmon"},{hex:"#F4A460",name:"SandyBrown"},{hex:"#FFF5EE",name:"SeaShell"},{hex:"#A0522D",name:"Sienna"},{hex:"#C0C0C0",name:"Silver"},{hex:"#87CEEB",name:"SkyBlue"},{hex:"#6A5ACD",name:"SlateBlue"},{hex:"#708090",name:"SlateGray"},{hex:"#FFFAFA",name:"Snow"},{hex:"#4682B4",name:"SteelBlue"},{hex:"#D2B48C",name:"Tan"},{hex:"#008080",name:"Teal"},{hex:"#D8BFD8",name:"Thistle"},{hex:"#FF6347",name:"Tomato"},{hex:"#40E0D0",name:"Turquoise"},{hex:"#EE82EE",name:"Violet"},{hex:"#F5DEB3",name:"Wheat"},{hex:"#FFFF00",name:"Yellow"}]}var K,Ae;const ce=class{constructor(t,e){var s;this.inputs=new Array(t),this.outputs=new Array(e),this.biases=new Array(e),this.weights=[];for(let i=0;i<t;i++)this.weights[i]=new Array(e);h(s=ce,K,Ae).call(s,this)}static feedForward(t,e){for(let s=0;s<e.inputs.length;s++)e.inputs[s]=t[s];for(let s=0;s<e.outputs.length;s++){let i=0;for(let n=0;n<e.inputs.length;n++)i+=e.inputs[n]*e.weights[n][s];i>e.biases[s]?e.outputs[s]=1:e.outputs[s]=0}return e.outputs}};let C=ce;K=new WeakSet,Ae=function(t){for(let e=0;e<t.inputs.length;e++)for(let s=0;s<t.outputs.length;s++)t.weights[e][s]=Math.random()*2-1;for(let e=0;e<t.biases.length;e++)t.biases[e]=Math.random()*2-1},a(C,K);var z,Se,J,Pe;const me=class{constructor({neuronCounts:t=!1,brain:e=!1,mutationRate:s=0}){a(this,z);a(this,J);if(this.layers=[],e){h(this,J,Pe).call(this,e),s&&me.mutate(this,s);return}h(this,z,Se).call(this,t)}static feedForward(t,e){let s=C.feedForward(t,e.layers[0]);for(let i=1;i<e.layers.length;i++)s=C.feedForward(s,e.layers[i]);return s}static mutate(t,e=1){t.layers.forEach(s=>{for(let i=0;i<s.biases.length;i++)s.biases[i]=xe(s.biases[i],Math.random()*2-1,e);for(let i=0;i<s.weights.length;i++)for(let n=0;n<s.weights[i].length;n++)s.weights[i][n]=xe(s.weights[i][n],Math.random()*2-1,e)})}};let R=me;z=new WeakSet,Se=function(t){for(let e=0;e<t.length-1;e++)this.layers.push(new C(t[e],t[e+1]))},J=new WeakSet,Pe=function(t){this.layers=JSON.parse(JSON.stringify(t.layers))};var A,S,le,Y,be,X,Te,Q,ke,Z,Oe;const w=class extends ve{constructor({coordinates:e,spacing:s,colour:i,registeredWith:n,coordToPosition:o,energy:l,brain:u=null,frame:Ke=1}){const ze=Math.floor(s/2-2);super({coordinates:e,radius:ze,colour:i});a(this,S);a(this,Y);a(this,X);a(this,Q);a(this,Z);this.energy=l,this.spacing=s,this.registerHandler=n,this.coordToPosition=o,this.sensor=new D,this.age=0,this.reproductionCooldown=60,this.nextMove=null,this.lastUpdatedFrame=Ke,this.brain=new R({neuronCounts:[25,30,20,5],brain:u,mutationRate:.05}),h(this,S,le).call(this)}update(e){if(this.lastUpdatedFrame!=e){if(this.lastUpdatedFrame=e,this.age+=1,this.reproductionCooldown-=1,this.energy-=1,this.energy<=0){h(this,Y,be).call(this);return}h(this,X,Te).call(this),this.nextMove&&this.move(this.nextMove)}}move(e){const s=d.sumCoords(this.getCoordinates(),e);this.registerHandler.validMove(s)&&(this.setCoordinates(s),h(this,S,le).call(this))}eat(e){this.energy+=e,this.energy>w.maxEnergy&&(this.energy=m(w,A))}getType(){return"Life"}draw(e){const s=this.coordToPosition(this.getCoordinates());e.beginPath(),e.arc(s.x,s.y,this.getRadius(),Math.PI*2,!1),e.fillStyle=this.getColour(),e.fill()}};let O=w;A=new WeakMap,S=new WeakSet,le=function(){this.registerHandler.update(this)},Y=new WeakSet,be=function(){this.registerHandler.addAge(this.age),this.registerHandler.remove(this)},X=new WeakSet,Te=function(){this.sensor.sense(this.getCoordinates(),this.registerHandler,32);const e=this.sensor.lifeSense.map(u=>u/8),s=this.sensor.foodSense.map(u=>u/32),i=this.sensor.wallSense.map(u=>u/8),n=e.concat(s).concat(i);n.push(this.energy/m(w,A));const o=R.feedForward(n,this.brain);if(o[4]&&this.energy>=4&&this.reproductionCooldown<=0){const u=h(this,Q,ke).call(this);if(u){this.reproductionCooldown=30,h(this,Z,Oe).call(this,u);return}}let l=new d({x:0,y:0});o[0]&&l.add(f.up),o[1]&&l.add(f.right),o[2]&&l.add(f.down),o[3]&&l.add(f.left),this.nextMove=l},Q=new WeakSet,ke=function(){const e=D.offsets.filter(i=>this.registerHandler.validMove(d.sumCoords(this.getCoordinates(),i)));if(e.length===0)return!1;const s=Math.floor(Math.random()*e.length);return d.sumCoords(this.getCoordinates(),e[s])},Z=new WeakSet,Oe=function(e){const s=Math.floor(this.energy/2);let i=this.getColour();if(Math.random()<1e-4){const n=Math.floor(Math.random()*L().length);i=L()[n].name}new w({coordinates:e,spacing:this.spacing,colour:i,registeredWith:this.registerHandler,coordToPosition:this.coordToPosition,energy:s,brain:this.brain,frame:this.lastUpdatedFrame}).brain,this.energy-=s},a(O,A,400);var P,b,T,$,Le;class $e extends ve{constructor({coordinates:e,spacing:s,colour:i,registeredWith:n,coordToPosition:o,energyValue:l=20}){const u=Math.floor(s/2-2);super({coordinates:e,radius:u,colour:i});a(this,$);a(this,P,void 0);a(this,b,void 0);a(this,T,void 0);g(this,P,n),g(this,b,o),g(this,T,l),h(this,$,Le).call(this)}getType(){return"Food"}update(){}draw(e){const s=m(this,b).call(this,this.getCoordinates());e.beginPath(),e.arc(s.x,s.y,this.getRadius(),Math.PI*2,!1),e.fillStyle=this.getColour(),e.fill()}getEnergy(){return m(this,T)}}P=new WeakMap,b=new WeakMap,T=new WeakMap,$=new WeakSet,Le=function(){m(this,P).update(this)};var _,Re,ee,He,k,de;class _e{constructor(t,e){a(this,_);a(this,ee);a(this,k);this.values=[],this.width=t,this.height=e;for(let s=0;s<t*e;s++)this.values.push(null)}get(t,e){return h(this,_,Re).call(this,t,e)}set(t,e,s){h(this,ee,He).call(this,t,e,s)}forEach(t){this.values.forEach(t)}findIndex(t){for(let e=0;e<this.width*this.height;e++)if(this.values[e]===t)return this.indexToCoords(e);return-1}indexToCoords(t){return{x:t%this.width,y:Math.floor(t/this.width)}}}_=new WeakSet,Re=function(t,e){if(h(this,k,de).call(this,t,e))return this.values[t+e*this.width]},ee=new WeakSet,He=function(t,e,s){h(this,k,de).call(this,t,e)&&(this.values[t+e*this.width]=s)},k=new WeakSet,de=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height};var te,Ie,se,We,ie,qe;class et{constructor({width:t,height:e}){a(this,te);a(this,se);a(this,ie);this.array2D=new _e(t,e)}get(t,e){return h(this,te,Ie).call(this,t,e)}set(t,e,s){h(this,se,We).call(this,t,e,s)}findIndex(t){return h(this,ie,qe).call(this,t)}forEach(t){this.array2D.forEach(t)}}te=new WeakSet,Ie=function(t,e){return this.array2D.get(t-1,e-1)},se=new WeakSet,We=function(t,e,s){this.array2D.set(t-1,e-1,s)},ie=new WeakSet,qe=function(t){const e=this.array2D.findIndex(t);return e===-1?-1:{x:e.x+1,y:e.y+1}};var ne,Ve,re,je,ae,Ne;class tt{constructor({width:t,height:e}){a(this,ne);a(this,re);a(this,ae);this.register=new et({width:t,height:e}),this.currentFrame=0,this.ages=[]}incrementFrame(){this.currentFrame+=1}getCurrentFrame(){return this.currentFrame}update(t){h(this,ae,Ne).call(this,t)}remove(t){h(this,ne,Ve).call(this,t)}eachObject(t){this.register.forEach(t)}validMove({x:t,y:e}){return h(this,re,je).call(this,t,e)}getObjectAt(t,e){return this.register.get(t,e)}addAge(t){this.ages.push(t),this.ages.length>100&&this.ages.shift()}averageAge(){return this.ages.length===0?0:this.ages.reduce((t,e)=>t+e)/this.ages.length}}ne=new WeakSet,Ve=function(t){const e=this.register.findIndex(t);e!==-1&&this.register.set(e.x,e.y,null)},re=new WeakSet,je=function(t,e){const s=this.register.get(t,e);return s===void 0?!1:s===null||s.getType()==="Food"},ae=new WeakSet,Ne=function(t){const e=this.register.findIndex(t),s=t.getCoordinates();if(e!==-1){if(e.x===s.x&&e.y===s.y)return;this.register.set(e.x,e.y,null)}const i=this.register.get(s.x,s.y);i&&t.eat(i.getEnergy()),this.register.set(s.x,s.y,t)};const B=new Qe({id:"gridCanvas"}),c=x.create({dimensions:{x:160,y:90},canvasSize:B.getDimensions(),midPoint:B.getMidPoint()}),F=new tt({width:c.dimensions.x,height:c.dimensions.y});function st(r){for(let t=0;t<r;t++){const e={x:Math.ceil(Math.random()*c.dimensions.x),y:Math.ceil(Math.random()*c.dimensions.y)};if(F.getObjectAt(e.x,e.y)===null){const s=Math.floor(Math.random()*L().length);new O({coordinates:e,spacing:c.getSpacing(),colour:L()[s].name,registeredWith:F,coordToPosition:c.coordToPosition,energy:100})}}}function Ge(r){for(let t=0;t<r;t++){const e={x:Math.ceil(Math.random()*c.dimensions.x),y:Math.ceil(Math.random()*c.dimensions.y)};F.getObjectAt(e.x,e.y)===null&&new $e({coordinates:e,spacing:c.getSpacing(),colour:"green",registeredWith:F,coordToPosition:c.coordToPosition,energyValue:100})}}let fe=10;st(250);Ge(1500);Ue();function Ue(){fe%10==0&&(B.clear(),c.drawLines(B.getCtx()),F.incrementFrame(),F.eachObject(r=>{r!=null&&r.update(F.getCurrentFrame())}),Ge(5),F.eachObject(r=>{r!=null&&r.draw(B.getCtx())})),fe++,requestAnimationFrame(Ue)}
